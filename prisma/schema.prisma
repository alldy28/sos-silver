generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model SossilverProduct {
  id             String          @id @default(cuid())
  nama           String
  series         String?
  gramasi        Float
  fineness       Int
  hargaJual      Int
  hargaBuyback   Int
  tahunPembuatan Int?
  gambarUrl      String?
  createdAt      DateTime        @default(now())
  codes          GeneratedCode[]
  invoiceItems   InvoiceItem[]
}

model GeneratedCode {
  id           String           @id @default(cuid())
  kode         String           @unique
  sequentialId Int?
  isUsed       Boolean          @default(false)
  createdAt    DateTime         @default(now())
  productId    String
  product      SossilverProduct @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  
  // Kolom untuk Role dan Verifikasi
  role          Role      @default(CUSTOMER)
  emailVerified DateTime?
  verificationToken String?   @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt @default(now())

  // Relasi 1: Invoice yang DIBUAT oleh Admin
  createdInvoices Invoice[] @relation("AdminCreator")
  
  // Relasi 2: Order yang DIMILIKI oleh Customer
  orders          Invoice[] @relation("CustomerOwner")
}

model PriceImage {
  id       String @id @default("current_price_list")
  imageUrl String
}

model PromoSlide {
  id             String   @id @default(cuid())
  imageUrl       String
  destinationUrl String?
  order          Int
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([order])
}

model Invoice {
  id              String   @id @default(cuid())
  invoiceNumber   String   @unique
  customerName    String
  customerPhone   String?
  customerAddress String?
  
  // Data Keuangan
  totalAmount     Int
  shippingFee     Int      @default(0)
  subTotal        Float    @default(0)
  discountPercent Float    @default(0)
  
  // [PERBAIKAN] Menggunakan 'String' sesuai skema Anda
  status          String   @default("UNPAID")
  paymentProofUrl String?
  
  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relasi 1: Admin yang membuat
  createdById     String
  createdBy       User     @relation("AdminCreator", fields: [createdById], references: [id])
  
  // Relasi 2: Customer yang memiliki (opsional)
  customerId      String?
  customer        User?    @relation("CustomerOwner", fields: [customerId], references: [id])

  // Relasi ke Item
  items           InvoiceItem[]
}

model InvoiceItem {
  id          String           @id @default(cuid())
  quantity    Int
  priceAtTime Int
  gramasi     Float            @default(0) // Sesuai tabel Anda

  // Relasi
  invoice   Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  invoiceId String
  product   SossilverProduct @relation(fields: [productId], references: [id])
  productId String
}

// Enum untuk Role (Sudah ada di skema Anda)
enum Role {
  ADMIN
  CUSTOMER
}

// [DIHAPUS] Enum InvoiceStatus dihapus
// karena Anda menggunakan 'String'